/*! Stream 1.4.0 - Admin JS */
jQuery(function(a){a(".toplevel_page_wp_stream :input.chosen-select").each(function(b,c){var d={},e=function(b,c){var d="",e=a(b.element),f="";return void 0!==b.icon?f=b.icon:void 0!==e.attr("data-icon")&&(f=e.data("icon")),f&&(d+='<img src="'+f+'" class="wp-stream-select2-icon">'),d+=b.text,c.attr("title",e.attr("title")),d};d=a(c).find("option").length>0?{minimumResultsForSearch:10,formatResult:e,allowClear:!0,width:"165px"}:{minimumInputLength:3,allowClear:!0,width:"165px",ajax:{url:ajaxurl,datatype:"json",data:function(b){return{action:"wp_stream_filters",filter:a(c).attr("name"),q:b}},results:function(a){return{results:a}}},formatResult:e,initSelection:function(b,c){var d=a(b).val();""!==d&&a.post(ajaxurl,{action:"wp_stream_get_filter_value_by_id",filter:a(b).attr("name"),id:d},function(a){c({id:d,text:a})},"json")}},a(c).select2(d)});var b=function(b,c){var d=c.data("select-placeholder"),e=d+"-child",f=c.siblings("."+d);jQuery("."+e).off().remove(),"undefined"==typeof b.val&&(b.val=c.val().split(",")),a.each(b.val.reverse(),function(a,b){return null===b||"__placeholder__"===b||""===b?!0:void f.after(f.clone(!0).attr("class",e).val(b))})};a("#tab-content-settings input[type=hidden].select2-select.with-source").each(function(c,d){var e=a(d);e.select2({multiple:!0,width:350,data:e.data("values"),query:function(b){var c={results:[]};"undefined"!=typeof b.term&&a.each(e.data("values"),function(){(0===b.term.length||this.text.toUpperCase().indexOf(b.term.toUpperCase())>=0)&&c.results.push({id:this.id,text:this.text})}),b.callback(c)},initSelection:function(a,b){b(a.data("selected"))}}).on("change",function(a){b(a,e)}).trigger("change")}),a("#tab-content-settings input[type=hidden].select2-select.ip-addresses").each(function(c,d){var e=a(d);e.select2({tags:e.data("selected"),width:350,ajax:{type:"POST",url:ajaxurl,dataType:"json",quietMillis:500,data:function(a){return{find:a,limit:10,action:"stream_get_ips",nonce:e.data("nonce")}},results:function(b){var c={results:[]};return b.success!==!0||void 0===b.data?c:(a.each(b.data,function(a,b){c.results.push({id:b,text:b})}),c)}},initSelection:function(a,b){b(a.data("selected"))},formatNoMatches:function(){return""},createSearchChoice:function(b){var c=[];return c=b.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/),null===c||(c.shift(),c=a.grep(c,function(a){var b=parseInt(a,10);return 255>=b&&b.toString()===a}),c.length<4)?void 0:{id:b,text:b}}}).on("change",function(a){b(a,e)}).trigger("change")});var c;a("#tab-content-settings input[type=hidden].select2-select.authors_and_roles").each(function(b,d){c=a(d),c.select2({multiple:!0,width:350,ajax:{type:"POST",url:ajaxurl,dataType:"json",quietMillis:500,data:function(a,b){return{find:a,limit:10,pager:b,action:"stream_get_users",nonce:c.data("nonce")}},results:function(b){var d=[],e=[];return d=a.grep(c.data("values"),function(a){return a.text.toLowerCase().indexOf(c.data("select2").search.val().toLowerCase())>=0}),e={results:[{text:"Roles",children:d},{text:"Users",children:[]}]},b.success!==!0||void 0===b.data||b.data.status!==!0?e:(a.each(b.data.users,function(b,c){a.contains(d,c.id)&&(c.disabled=!0)}),e.results[1].children=b.data.users,e)}},formatResult:function(a,b){var c=a.text;return"undefined"!=typeof a.icon&&(c='<img src="'+a.icon+'" class="wp-stream-select2-icon">'+c,b.attr("title",a.tooltip)),"undefined"!=typeof a.tooltip?b.attr("title",a.tooltip):"undefined"!=typeof a.user_count&&b.attr("title",a.user_count),c},formatSelection:function(b){return a.isNumeric(b.id)&&b.text.indexOf("icon-users")<0&&(b.text+='<i class="icon16 icon-users"></i>'),b.text},initSelection:function(a,b){b(a.data("selected"))}})}).on("change",function(a){b(a,c)}).trigger("change"),a(window).load(function(){a(".toplevel_page_wp_stream [type=search]").off("mousedown")}),a("#wp_stream_general_delete_all_records, #wp_stream_network_general_delete_all_records").click(function(a){confirm(wp_stream.i18n.confirm_purge)||a.preventDefault()}),a("#wp_stream_general_reset_site_settings, #wp_stream_network_general_reset_site_settings").click(function(a){confirm(wp_stream.i18n.confirm_defaults)||a.preventDefault()}),a("#wp_stream_uninstall").click(function(a){confirm(wp_stream.i18n.confirm_uninstall)||a.preventDefault()});var d=a(".nav-tab-wrapper"),e=a(".nav-tab-content table.form-table"),f=d.find(".nav-tab-active"),g=f.length>0?d.find("a").index(f):0,h=window.location.hash.match(/^#(\d+)$/),i=null!==h?h[1]:g,j=function(b){var c=a('input[name="option_page"][value^="wp_stream"]').parent("form"),d=c.attr("action");c.prop("action",d.replace(/(^[^#]*).*$/,"$1#"+b))};d.on("click","a",function(){var b=d.find("a").index(a(this)),c=window.location.hash.match(/^#(\d+)$/);return e.hide().eq(b).show(),d.find("a").removeClass("nav-tab-active").filter(a(this)).addClass("nav-tab-active"),(""===window.location.hash||null!==c)&&(window.location.hash=b),j(b),!1}),d.children().eq(i).trigger("click"),a(document).ready(function(){function b(){var b=!0;a("div.date-interval").is(":hidden")||(b=!1);var c=a("div.alignleft.actions div.select2-container");c.each(function(){return a(this).is(":hidden")?void 0:(b=!1,!1)}),b?(a("input#record-query-submit").hide(),a("span.filter_info").show()):(a("input#record-query-submit").show(),a("span.filter_info").hide())}if("toplevel_page_wp_stream"===wp_stream.current_screen&&"1"===wp_stream.current_page&&"asc"!==wp_stream.current_order){var c=".toplevel_page_wp_stream #the-list";wp.heartbeat.interval("fast"),a(document).on("heartbeat-send.stream",function(b,d){d["wp-stream-heartbeat"]="live-update";var e=a(c+" tr:first .column-id"),f=1;0!==e.length&&(f=""===e.text()?1:e.text()),d["wp-stream-heartbeat-last-id"]=f,d["wp-stream-heartbeat-query"]=wp_stream.current_query}),a(document).on("heartbeat-tick.stream",function(b,d){if(d["wp-stream-heartbeat"]&&0!==d["wp-stream-heartbeat"].length){var e=a("#edit_stream_per_page").val(),f=a(c+" tr"),g=a(d["wp-stream-heartbeat"]);g.removeClass().addClass("new-row");var h=f.first().hasClass("alternate");if(1!==g.length||h){var i=g.length%2!==0||h?"odd":"even";g.filter(":nth-child("+i+")").addClass("alternate")}else g.addClass("alternate");a(c).prepend(g),a(".metabox-prefs input").each(function(){if(a(this).prop("checked")!==!0){var b=a(this).val();a("td.column-"+b).hide()}});var j=e-(g.length+f.length);0>j&&a(c+" tr").slice(j).remove(),a(c+" tr.no-items").remove();var k=d.total_items_i18n||"";k&&(a(".displaying-num").text(k),a(".total-pages").text(d.total_pages_i18n),a(".tablenav-pages").find(".next-page, .last-page").toggleClass("disabled",d.total_pages===a(".current-page").val()),a(".tablenav-pages .last-page").attr("href",d.last_page_link)),a(c).parent().trigger("updated"),setTimeout(function(){a(".new-row").addClass("fadeout"),setTimeout(function(){a(c+" tr").removeClass("new-row fadeout")},500)},3e3)}}),a("#enable_live_update").click(function(){var b=a("#stream_live_update_nonce").val(),c=a("#enable_live_update_user").val(),d="unchecked";a("#enable_live_update").is(":checked")&&(d="checked"),a.ajax({type:"POST",url:ajaxurl,data:{action:"stream_enable_live_update",nonce:b,user:c,checked:d},dataType:"json",beforeSend:function(){a(".stream-live-update-checkbox .spinner").show().css({display:"inline-block"})},success:function(){a(".stream-live-update-checkbox .spinner").hide()}})}),a('div.stream-toggle-filters [id="date"]').is(":checked")?a("div.date-interval").show():a("div.date-interval").hide();for(var d in wp_stream.filters)a('div.stream-toggle-filters [id="'+d+'"]').is(":checked")?a('[name="'+d+'"]').prev(".select2-container").show():a('[name="'+d+'"]').prev(".select2-container").hide();b(),a("div.stream-toggle-filters input[type=checkbox]").click(function(){var c=a(this).closest("div").find("input:checkbox");c.attr("disabled",!0);var d=a("#toggle_filters_nonce").val(),e=a("#toggle_filters_user").val(),f="unchecked",g=a(this).attr("id");a(this).is(":checked")&&(f="checked"),a.ajax({type:"POST",url:ajaxurl,data:{action:"stream_toggle_filters",nonce:d,user:e,checked:f,checkbox:g},dataType:"json",beforeSend:function(){a(g+" .spinner").show().css({display:"inline-block"})},success:function(c){var d=a("div.date-interval");if("date"===c.control)d.toggle();else{var e=a('[name="'+c.control+'"]');e.is("select")&&a(e).prev(".select2-container").toggle()}b()}}),c.attr("disabled",!1)}),a("#ui-datepicker-div").addClass("stream-datepicker")}}),a("table.wp-list-table").on("updated",function(){var b=a(this).find("time.relative-time");b.each(function(b,c){var d=a(c);d.removeClass("relative-time"),a('<strong><time datetime="'+d.attr("datetime")+'" class="timeago"/></time></strong><br/>').prependTo(d.parent().parent()).find("time.timeago").timeago()})}).trigger("updated");var k={init:function(b){this.wrapper=b,this.save_interval(this.wrapper.find(".button-primary"),this.wrapper),this.$=this.wrapper.each(function(b,c){var d=a(c),e=d.find(".date-inputs"),f=d.find(".field-from"),g=d.find(".field-to"),h=g.prev(".date-remove"),i=f.prev(".date-remove"),j=d.children(".field-predefined"),k=a("").add(g).add(f);if(jQuery.datepicker){var l=parseFloat(wp_stream.gmt_offset),m=(new Date).getTimezoneOffset()/60*-1,n=l-m,o=new Date,p=new Date(o.getTime()+60*n*60*1e3),q="0";(o.getDate()!==p.getDate()||o.getMonth()!==p.getMonth())&&(q=o.getTime()<p.getTime()?"+1d":"-1d"),k.datepicker({dateFormat:"yy/mm/dd",maxDate:q,defaultDate:p,beforeShow:function(){a(this).prop("disabled",!0)},onClose:function(){a(this).prop("disabled",!1)}}),k.datepicker("widget").addClass("stream-datepicker")}j.select2({allowClear:!0}),""!==f.val()&&i.show(),""!==g.val()&&h.show(),j.on({change:function(){var b=a(this).val(),c=j.find('[value="'+b+'"]'),d=c.data("to"),h=c.data("from");return"custom"===b?(e.show(),f.datepicker("show"),!1):(e.hide(),k.datepicker("hide"),f.val(h).trigger("change",[!0]),g.val(d).trigger("change",[!0]),void(jQuery.datepicker&&k.datepicker("widget").is(":visible")&&k.datepicker("refresh").datepicker("hide")))},"select2-removed":function(){j.val("").trigger("change")},check_options:function(){if(""!==g.val()&&""!==f.val()){var a=j.find("option").filter('[data-to="'+g.val()+'"]').filter('[data-from="'+f.val()+'"]');0!==a.length?j.val(a.attr("value")).trigger("change",[!0]):j.val("custom").trigger("change",[!0])}else""===g.val()&&""===f.val()?j.val("").trigger("change",[!0]):j.val("custom").trigger("change",[!0])}}),f.on({change:function(){return""!==f.val()?(i.show(),g.datepicker("option","minDate",f.val())):i.hide(),arguments[arguments.length-1]===!0?!1:void j.trigger("check_options")}}),g.on({change:function(){return""!==g.val()?(h.show(),f.datepicker("option","maxDate",g.val())):h.hide(),arguments[arguments.length-1]===!0?!1:void j.trigger("check_options")}}),j.trigger("change"),a("").add(i).add(h).on({click:function(){a(this).next("input").val("").trigger("change")}})})},save_interval:function(b){var c=this.wrapper;b.click(function(){var b={key:c.find("select.field-predefined").find(":selected").val(),start:c.find(".date-inputs .field-from").val(),end:c.find(".date-inputs .field-to").val()};a(this).attr("href",a(this).attr("href")+"&"+a.param(b))})}};a(".wp-stream-feeds-key #stream_user_feed_key_generate").click(function(b){b.preventDefault();var c=a("#user_id").val(),d=a(".wp-stream-feeds-key #wp_stream_generate_key_nonce").val();a.ajax({type:"POST",url:ajaxurl,data:{action:"wp_stream_feed_key_generate",nonce:d,user:c},dataType:"json",beforeSend:function(){a(".wp-stream-feeds-key .spinner").show().css({display:"inline-block"})},success:function(b){a(".wp-stream-feeds-key .spinner").hide(),(b.success===!0||void 0!==b.data)&&(a(".wp-stream-feeds-key #stream_user_feed_key").val(b.data.feed_key),a(".wp-stream-feeds-links a.rss-feed").attr("href",b.data.xml_feed),a(".wp-stream-feeds-links a.json-feed").attr("href",b.data.json_feed))}})}),a(document).ready(function(){k.init(a(".date-interval"))})});